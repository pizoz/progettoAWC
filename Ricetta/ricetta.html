<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe</title>
    <!-- Option 1: Include in HTML -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">  
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
    <link rel="stylesheet" href="ricetta.css">
    <link rel="icon" href="../img/SIDE_BABY__1_-removebg-preview.png">
    <script src="ricetta.js"></script>

</head>
<body onload="body()" >
    <!-- Navbar -->
    <header>
        <div class="container">
            <div class="row" id="navbar">
                <nav class="navbar navbar-expand-lg">
                    <div class="col-4 col-lg-4">
                        <a href="../Homepage/homepage.html" class="navbar-brand">
                            <img src="../img/SIDE_BABY__1_-removebg-preview (1).png" alt="logo" height="40" id="logo"/>
                        </a>
                    </div>
                    <div class="col-4 col-lg-4">
                    </div>
                    <div class="col-4 text-end d-lg-none">
                        <button
                            class="navbar-toggler"
                            type="button"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#navbarNav"
                            aria-controls="navbarNav"
                            aria-expanded="false"
                            aria-label="Toggle navigation"
                        >
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    <div class="offcanvas offcanvas-end" tabindex="-1" id="navbarNav" aria-labelledby="navbarNavLabel">
                        <div class="offcanvas-header">
                            <h5 class="offcanvas-title" id="navbarNavLabel"></h5>
                            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                        </div>
                        <div class="offcanvas-body">
                            <ul class="navbar-nav ms-auto">
                                
                                <li class="nav-item align-content-end">
                                    <a href="../Signup/signup.html" class="nav-link" id="profilo">Registrati</a>
                                </li>
                                <li class="nav-item align-content-end">
                                    <a class="nav-link" id="login">Login</a>
                                </li>
                            </ul>
                        </div>
                        <script>
                            document.addEventListener("DOMContentLoaded", function() {
                                
                                var logged = localStorage.getItem("logged");
                                var profileLink = document.getElementById("profilo");
                                var loginLink = document.getElementById("login"); // Declare the loginLink variable
                            if ( logged == "true") {
                                profileLink.innerHTML = "<i class='bi bi-person'></i>"+" "+localStorage.getItem("LoggedUser");
                                profileLink.href = "../Profile/profile.html";
                                loginLink.innerHTML = "<i class='bi bi-box-arrow-right'></i>"+" Logout";
                                loginLink.href = window.location.href;
                                loginLink.onclick = function() {
                                    localStorage.setItem("logged", "false");
                                    localStorage.setItem("LoggedUser", ""); 
                                };
                            } else {
                                profileLink.innerHTML = "<i class='bi bi-pencil'></i> Registrati";
                                profileLink.href = "../Signup/signup.html";
                                loginLink.innerHTML = "<i class='bi bi-box-arrow-in-right'></i> Login";
                                loginLink.href = "../login/login.html";
                            }
                            });
                        </script>
                    </div>
                    
                </nav>
            </div>
        </div>
    </header>
    <main>
        <!-- Barra di ricerca -->
        <div class="container-fluid m-3">
            <div class="row">
                <div class="col-3">
                </div>
                <div class="col-6" id="searchbar">
                    <h3 style="text-align: center;"> Cosa vuoi mangiare oggi?</h3>
                    <form class="d-flex" onsubmit="event.preventDefault();search()">
                        
                        <input id="inputsearch"
                            class="form-control me-2"
                            type="search"
                            aria-label="Search"
                        />
                        <button class="btn btn-outline-success" type="submit" id="searchbutton">
                            Cerca
                        </button>
                    </form>
                </div>
                <div class="col-3" >
                </div>
            </div>
        </div>
        <!-- Body ricetta -->
        <div class="container m-auto" >
            <div class="row align-items-center" id="titolo">
                
                <div class="col-lg-6 col-sm-12 d-flex justify-content-center " id="img">

                </div> 

                <div class="col-lg-6 col-sm-12 d-flex flex-column " id="title">
                </div>
            </div>
            <div class="row" id="rigapreparazione">
                <div class="col-lg-6 col-sm-12" id="ingredients">
                    
                </div>
                <div class="col-lg-6 col-sm-12" id="instructions">
                    
                </div>
            </div>
            <div class="row" id="rowvideo">
                <div id="video">

                </div>
            </div>
            <div class="row" id="recensioni">
               
            </div>
            <div class="row" id="formrecensione">
                <div class="col-12" id="form">
                     <h3 class="text-center m-2">Lascia una recensione!</h3>
                    <form class="row g-3" id="recensione" method="post" onsubmit="addRecensione()">
                        <div class="col-6">
                            <label for="titolorecensione" class="form-label">Titolo</label>
                            <input type="text" class="form-control" id="titolorecensione" name="titolorecensione" required>
                        </div>
                        <!-- Il codice per la gestione di gusto e difficoltà è a piè di pagina -->
                        <div class="col-3" id="gustoform">
                            <label for="voto" class="form-label">Gusto</label>
                            <div id="star-rating">
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                            </div>
                        <input type="hidden" id="gusto" name="gusto" value="0" required>
                        <p></p>
                        </div>
                        <div class="col-3" id="difficoltaform">
                            <label for="voto" class="form-label">Difficoltà</label>
                            <div id="star-rating">
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                                <i class="bi bi-star"></i>
                            </div>
                            <input type="hidden" id="difficolta" name="difficolta" value="0" required>
                        </div>
                        <div class="col-12">
                            <label for="testo" class="form-label">Recensione</label>
                            <textarea class="form-control" id="testo" name="testo" required></textarea>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">Invia</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
    </main>
    <footer class="p-5 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <p>
                         <a href="../Homepage/homepage.html">Home</a> | <a href="mailto:niccolo.pizzocri@studenti.unimi.it?subject=FORZA%20JUVE&body=SIUUUUUUUUUUUM">Contact</a>
                    </p>
                    <p>&copy; 2024 - Niccolò Pizzocri</p>
                </div>
            </div>
        </div>
    </footer>
    <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
    <script>
        // funzione che gestisce l'inserimento di un voto tramite il click sulle stelline
        document.addEventListener("DOMContentLoaded", function() {
            var gusto = document.getElementById("gustoform");
            var stars = gusto.querySelectorAll(".bi-star");
            var rating = document.getElementById("gusto");
            
            stars.forEach(function(star, index) {
                // se clicco salvo il rating
                star.addEventListener("click", function() {
                    rating.value = index + 1;
                    stars.forEach(function(s, i) {
                        if (i <= index) {
                            s.classList.remove("bi-star");
                            s.classList.add("bi-star-fill");
                        } else {
                            s.classList.remove("bi-star-fill");
                            s.classList.add("bi-star");
                        }
                    });
                    star.removeEventListener("mouseover", mouseOverHandler);
                    star.removeEventListener("mouseout", mouseOutHandler);
                });
                // se vado sopra col mouse vengono colorate le stelline
                function mouseOverHandler() {
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.classList.remove("bi-star");
                            s.classList.add("bi-star-fill");
                        } else {
                            s.classList.remove("bi-star-fill");
                            s.classList.add("bi-star");
                        }
                    });
                }
                // se esco, rimangono le stelline cliccate
                function mouseOutHandler() {
                    stars.forEach((s, i) => {
                        if (i <= rating.value - 1) {
                            s.classList.remove("bi-star");
                            s.classList.add("bi-star-fill");
                        } else {
                            s.classList.remove("bi-star-fill");
                            s.classList.add("bi-star");
                        }
                    });
                }

                star.addEventListener("mouseover", mouseOverHandler);
                star.addEventListener("mouseout", mouseOutHandler);
            });
            // faccio la stessa cosa per difficoltà
            var form = document.getElementById("difficoltaform");
            var stars2 = form.querySelectorAll(".bi-star");
            var difficolta = document.getElementById("difficolta");
            stars2.forEach(function(star, index) {
                star.addEventListener("click", function() {
                    difficolta.value = index + 1;
                    stars2.forEach(function(s, i) {
                        if (i <= index) {
                            s.classList.remove("bi-star");
                            s.classList.add("bi-star-fill");
                        } else {
                            s.classList.remove("bi-star-fill");
                            s.classList.add("bi-star");
                        }
                    });
                    star.removeEventListener("mouseover", mouseOverHandler);
                    star.removeEventListener("mouseout", mouseOutHandler);
                });

                function mouseOverHandler() {
                    stars2.forEach((s, i) => {
                        if (i <= index) {
                            s.classList.remove("bi-star");
                            s.classList.add("bi-star-fill");
                        } else {
                            s.classList.remove("bi-star-fill");
                            s.classList.add("bi-star");
                        }
                    });
                }

                function mouseOutHandler() {
                    stars2.forEach((s, i) => {
                        if (i <= difficolta.value - 1) {
                            s.classList.remove("bi-star");
                            s.classList.add("bi-star-fill");
                        } else {
                            s.classList.remove("bi-star-fill");
                            s.classList.add("bi-star");
                        }
                    });
                }

                star.addEventListener("mouseover", mouseOverHandler);
                star.addEventListener("mouseout", mouseOutHandler);
            });
        });
    </script>
</body>
</html>